{% extends "base.html" %}
{% block content %}

<div class="mb-5">
    {% if books %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0 text-primary"><i class="fa-solid fa-book-mark me-2"></i>Books Catalog</h3>
        <a href="/add_book" class="btn btn-premium btn-sm rounded-pill px-4">
            <i class="fa-solid fa-plus me-1"></i> Add New
        </a>
    </div>

    <form action="/view_books" method="GET" class="mb-4">
        <div class="glass-card p-2 d-flex shadow-sm rounded-pill overflow-hidden">
            <input type="text" name="q" class="form-control border-0 bg-transparent flex-grow-1"
                placeholder="Search by name, author or category..." value="{{ search_query }}">
            <button type="submit" class="btn btn-primary rounded-pill px-4">Search</button>
            {% if search_query %}
            <a href="/view_books" class="btn btn-link text-muted">Clear</a>
            {% endif %}
        </div>
    </form>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="text-muted small text-uppercase fw-bold">
                <tr>
                    <th class="ps-4">ID</th>
                    <th>Book Details</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for b in books %}
                <tr data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                    <td class="ps-4 fw-bold text-muted">{{ b.bookid }}</td>
                    <td>
                        <div class="fw-bold">{{ b.name }}</div>
                        <div class="small text-muted">{{ b.author }}</div>
                    </td>
                    <td><span
                            class="badge bg-light text-primary border border-primary border-opacity-25 px-3 rounded-pill">{{
                            b.category }}</span></td>
                    <td>
                        {% if b.status == 'Available' %}
                        <span class="badge bg-success-subtle text-success px-3 rounded-pill"><i
                                class="fa-solid fa-circle-check me-1"></i>Available</span>
                        {% else %}
                        <span class="badge bg-danger-subtle text-danger px-3 rounded-pill"><i
                                class="fa-solid fa-circle-minus me-1"></i>Issued</span>
                        {% endif %}
                    </td>
                    <td class="text-end pe-4">
                        <a href="/update_book/{{ b.bookid }}" class="btn btn-light btn-sm rounded-3 shadow-sm me-2"><i
                                class="fa-solid fa-pen-to-square"></i></a>
                        <a href="/delete_book/{{ b.bookid }}"
                            class="btn btn-light text-danger btn-sm rounded-3 shadow-sm"
                            onclick="return confirm('Delete this book?')"><i class="fa-solid fa-trash"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-4">
        <a href="/books" class="btn btn-link text-muted text-decoration-none"><i
                class="fa-solid fa-arrow-left me-2"></i>Back to Menu</a>
    </div>
    {% endif %}

    {% if students %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0 text-success"><i class="fa-solid fa-graduation-cap me-2"></i>Student Records</h3>
        <a href="/add_student" class="btn btn-premium btn-sm rounded-pill px-4 bg-success border-0"
            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <i class="fa-solid fa-plus me-1"></i> Add Student
        </a>
    </div>

    <form action="/view_students" method="GET" class="mb-4">
        <div class="glass-card p-2 d-flex shadow-sm rounded-pill overflow-hidden">
            <input type="text" name="q" class="form-control border-0 bg-transparent flex-grow-1"
                placeholder="Search by name or department..." value="{{ search_query }}">
            <button type="submit" class="btn btn-success rounded-pill px-4 border-0"
                style="background: #10b981;">Search</button>
            {% if search_query %}
            <a href="/view_students" class="btn btn-link text-muted">Clear</a>
            {% endif %}
        </div>
    </form>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="text-muted small text-uppercase fw-bold">
                <tr>
                    <th class="ps-4">ID</th>
                    <th>Full Name</th>
                    <th>Department</th>
                    <th>Year</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for s in students %}
                <tr data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                    <td class="ps-4 fw-bold text-muted">{{ s.studentid }}</td>
                    <td class="fw-bold">{{ s.name }}</td>
                    <td><span class="badge bg-success-subtle text-success px-3 rounded-pill">{{ s.department }}</span>
                    </td>
                    <td class="fw-semibold">Year {{ s.year }}</td>
                    <td class="text-end pe-4">
                        <a href="/update_student/{{ s.studentid }}"
                            class="btn btn-light btn-sm rounded-3 shadow-sm me-2"><i
                                class="fa-solid fa-user-pen"></i></a>
                        <a href="/delete_student/{{ s.studentid }}"
                            class="btn btn-light text-danger btn-sm rounded-3 shadow-sm"
                            onclick="return confirm('Delete this student?')"><i class="fa-solid fa-trash-can"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-4">
        <a href="/students" class="btn btn-link text-muted text-decoration-none"><i
                class="fa-solid fa-arrow-left me-2"></i>Back to Menu</a>
    </div>
    {% endif %}

    {% if issued %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0 text-warning"><i class="fa-solid fa-list-check me-2"></i>Issued Books Log</h3>
        <a href="/add_issued" class="btn btn-premium btn-sm rounded-pill px-4 bg-warning text-dark border-0"
            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
            <i class="fa-solid fa-hand-holding-hand me-1"></i> New Issue
        </a>
    </div>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="text-muted small text-uppercase fw-bold">
                <tr>
                    <th class="ps-4">Issue ID</th>
                    <th>Borrower</th>
                    <th>Book Info</th>
                    <th>Timeline</th>
                    <th>Due Status</th>
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for i in issued %}
                <tr data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                    <td class="ps-4 fw-bold text-muted">#{{ i.id }}</td>
                    <td>
                        <div class="fw-bold">{{ i.student_name }}</div>
                        <div class="small text-muted">ID: {{ i.studentid }}</div>
                    </td>
                    <td>
                        <div class="fw-bold text-truncate" style="max-width: 200px;">{{ i.book_name }}</div>
                        <div class="small text-muted">Book ID: {{ i.bookid }}</div>
                    </td>
                    <td>
                        <div class="small">Issued: <span class="fw-semibold">{{ i.issue_date }}</span></div>
                        <div class="small">Due: <span class="fw-semibold text-danger">{{ i.due_date }}</span></div>
                    </td>
                    <td>
                        {% if i.return_date %}
                        <span class="badge bg-success-subtle text-success px-3 rounded-pill"><i
                                class="fa-solid fa-check-double me-1"></i>Returned</span>
                        {% if i.fine > 0 %}
                        <div class="small text-danger fw-bold mt-1">Fine Paid: â‚¹{{ i.fine }}</div>
                        {% endif %}
                        {% else %}
                        <span class="badge bg-warning-subtle text-warning px-3 rounded-pill"><i
                                class="fa-solid fa-hourglass-half me-1 text-warning"></i>Active</span>
                        {% endif %}
                    </td>
                    <td class="text-end pe-4">
                        {% if not i.return_date %}
                        <a href="/return_book/{{ i.id }}"
                            class="btn btn-outline-success btn-sm rounded-pill px-3 me-2"><i
                                class="fa-solid fa-rotate-left me-1"></i>Return</a>
                        {% endif %}
                        <a href="/update_issued/{{ i.id }}" class="btn btn-light btn-sm rounded-3 shadow-sm me-1"><i
                                class="fa-solid fa-pen"></i></a>
                        <a href="/delete_issued/{{ i.id }}" class="btn btn-light text-danger btn-sm rounded-3 shadow-sm"
                            onclick="return confirm('Delete this record?')"><i class="fa-solid fa-trash"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-4">
        <a href="/" class="btn btn-link text-muted text-decoration-none"><i class="fa-solid fa-house me-2"></i>Back
            Home</a>
    </div>
    {% endif %}
</div>

{% endblock %}